<div class="container">
  <div class="page-header">
    <h1>Quiz Administration</h1>
    <p class="subtitle">Manage your exams, syllabi, chapters, and questions</p>
  </div>

  <!-- EXAM -->
  <mat-card class="section exam-section">
    <mat-card-header class="section-header">
      <div class="section-title-wrapper">
        <span class="section-icon">üìã</span>
        <h2>Exam Management</h2>
      </div>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="examForm" (ngSubmit)="createExam()" class="form-section">
        <div class="form-group">
          <label class="section-subtitle">Select Existing Exam</label>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Choose an exam</mat-label>
            <mat-select (selectionChange)="onSelectExam($event.value)">
              <mat-option [value]="null">-- none --</mat-option>
              <mat-option *ngFor="let e of exams" [value]="e.id">{{ e.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="divider-text">OR</div>

        <div class="form-group">
          <label class="section-subtitle">Create New Exam</label>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Exam Name</mat-label>
            <input matInput formControlName="name" placeholder="e.g., IIT JEE Main 2024" />
            <mat-error *ngIf="examForm.get('name')?.hasError('required')">Exam name is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Exam Image URL (optional)</mat-label>
            <input matInput formControlName="imageUrl" placeholder="https://example.com/image.jpg" />
          </mat-form-field>
        </div>

        <div class="action-buttons">
          <button mat-raised-button color="primary" type="submit" class="create-btn">
            <span>+ Create Exam</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- SYLLABUS -->
  <mat-card class="section syllabus-section" [class.disabled]="!selectedExamId">
    <mat-card-header class="section-header">
      <div class="section-title-wrapper">
        <span class="section-icon">üìö</span>
        <h2>Syllabus Management</h2>
      </div>
      <span class="status-badge" *ngIf="!selectedExamId">Select an exam first</span>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="syllabusForm" (ngSubmit)="createSyllabus()" class="form-section">
        <div class="form-group">
          <label class="section-subtitle">Select Existing Syllabus</label>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Choose a syllabus</mat-label>
            <mat-select (selectionChange)="onSelectSyllabus($event.value)" [disabled]="!selectedExamId">
              <mat-option [value]="null">-- none --</mat-option>
              <mat-option *ngFor="let s of syllabusList" [value]="s.id">{{ s.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="divider-text">OR</div>

        <div class="form-group">
          <label class="section-subtitle">Create New Syllabus</label>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Syllabus Name</mat-label>
            <input matInput formControlName="name" [disabled]="!selectedExamId" placeholder="e.g., Physics" />
            <mat-error *ngIf="syllabusForm.get('name')?.hasError('required')">Syllabus name is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Syllabus Image URL (optional)</mat-label>
            <input matInput formControlName="imageUrl" [disabled]="!selectedExamId" placeholder="https://example.com/image.jpg" />
          </mat-form-field>
        </div>

        <div class="action-buttons">
          <button mat-raised-button color="primary" type="submit" [disabled]="!selectedExamId" class="create-btn">
            <span>+ Create Syllabus</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- CHAPTER -->
  <mat-card class="section chapter-section" [class.disabled]="!selectedSyllabusId">
    <mat-card-header class="section-header">
      <div class="section-title-wrapper">
        <span class="section-icon">üìñ</span>
        <h2>Chapter Management</h2>
      </div>
      <span class="status-badge" *ngIf="!selectedSyllabusId">Select a syllabus first</span>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="chapterForm" (ngSubmit)="createChapter()" class="form-section">
        <div class="form-group">
          <label class="section-subtitle">Select Existing Chapter</label>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Choose a chapter</mat-label>
            <mat-select (selectionChange)="onSelectChapter($event.value)" [disabled]="!selectedSyllabusId">
              <mat-option [value]="null">-- none --</mat-option>
              <mat-option *ngFor="let c of chapterList" [value]="c.id">{{ c.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="divider-text">OR</div>

        <div class="form-group">
          <label class="section-subtitle">Create New Chapter</label>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Chapter Name</mat-label>
            <input matInput formControlName="name" [disabled]="!selectedSyllabusId" placeholder="e.g., Mechanics" />
            <mat-error *ngIf="chapterForm.get('name')?.hasError('required')">Chapter name is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Chapter Image URL (optional)</mat-label>
            <input matInput formControlName="imageUrl" [disabled]="!selectedSyllabusId" placeholder="https://example.com/image.jpg" />
          </mat-form-field>
        </div>

        <div class="action-buttons">
          <button mat-raised-button color="primary" type="submit" [disabled]="!selectedSyllabusId" class="create-btn">
            <span>+ Create Chapter</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- SINGLE QUESTION (MULTI-LANGUAGE) -->
  <mat-card class="section question-section">
    <mat-card-header class="section-header">
      <div class="section-title-wrapper">
        <span class="section-icon">‚ùì</span>
        <h2>Add Question with Multi-Language Support</h2>
      </div>
    </mat-card-header>
    <mat-card-content>
      <!-- Language Selector -->
      <app-language-selector></app-language-selector>

      <form [formGroup]="questionForm" (ngSubmit)="saveSingleQuestion()" class="form-section">
        <!-- Language Tabs for Question Content -->
        <div class="language-tabs-container">
          <mat-tab-group class="language-tabs">
            <mat-tab *ngFor="let lang of selectedLanguages" [label]="languageService.getLanguageFlag(lang) + ' ' + languageService.getLanguageName(lang)">
              
              <ng-template mat-tab-label>
                <span class="tab-content">
                  {{ languageService.getLanguageFlag(lang) }}
                  <span class="lang-label">{{ languageService.getLanguageName(lang) }}</span>
                </span>
              </ng-template>

              <!-- Question Title for this language -->
              <div class="tab-content-area">
                <div class="form-group">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Question in {{ languageService.getLanguageName(lang) }}</mat-label>
                    <textarea 
                      matInput 
                      [formControlName]="lang" 
                      formGroupName="titles"
                      rows="4" 
                      placeholder="Enter the question in {{ languageService.getLanguageName(lang) }}...">
                    </textarea>
                    <mat-error *ngIf="getTitleForLanguage(lang)?.hasError('required')">
                      Question text is required in {{ languageService.getLanguageName(lang) }}
                    </mat-error>
                  </mat-form-field>
                </div>

                <!-- Answer Options for this language -->
                <div class="form-group">
                  <label class="section-subtitle">Answer Options ({{ languageService.getLanguageName(lang) }})</label>
                  <div [formGroupName]="'optionsByLanguage'" class="options-container">
                    <div [formArrayName]="lang">
                      <div *ngFor="let ctrl of getOptionsForLanguage(lang).controls; let i = index" class="option-field">
                        <span class="option-label">{{ ['A', 'B', 'C', 'D'][i] }}</span>
                        <mat-form-field appearance="outline" class="full-width">
                          <mat-label>Option {{ i + 1 }}</mat-label>
                            <input 
                            matInput 
                            [formControlName]="i" 
                            placeholder="Enter option {{ i + 1 }} in {{ languageService.getLanguageName(lang) }}" />
                          <mat-error *ngIf="getOptionsForLanguage(lang).at(i).hasError('required')">
                            Option is required
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Correct Answer for this language -->
                <div class="form-group">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Correct Answer ({{ languageService.getLanguageName(lang) }})</mat-label>
                    <input 
                      matInput 
                      [formControlName]="lang"
                      formGroupName="correctAnswers"
                      placeholder="A, B, C, or D" />
                    <mat-hint>Enter the letter (A/B/C/D) or exact option text</mat-hint>
                    <mat-error *ngIf="getAnswerForLanguage(lang)?.hasError('required')">
                      Correct answer is required in {{ languageService.getLanguageName(lang) }}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </mat-tab>
          </mat-tab-group>
        </div>

        <!-- Image URL (common for all languages) -->
        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Question Image URL (optional)</mat-label>
            <input matInput formControlName="imageUrl" placeholder="https://example.com/image.jpg" />
          </mat-form-field>
        </div>

        <!-- Context Breadcrumb -->
        <div class="breadcrumb-hint">
          <span class="breadcrumb-label">Context:</span>
          <div class="breadcrumb-path">
            <span>{{ selectedExamName || 'No exam selected' }}</span>
            <span class="separator">/</span>
            <span>{{ selectedSyllabusName || 'No syllabus selected' }}</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button mat-raised-button color="primary" type="submit" class="create-btn">
            <span>‚úì Save Multi-Language Question</span>
          </button>
          <span class="language-count">{{ selectedLanguages.length }} language(s) selected</span>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- BULK QUESTIONS (MULTI-LANGUAGE SUPPORT) -->
  <mat-card class="section bulk-section">
    <mat-card-header class="section-header">
      <div class="section-title-wrapper">
        <span class="section-icon">üì§</span>
        <h2>Bulk Import Questions (Single & Multi-Language)</h2>
      </div>
    </mat-card-header>
    <mat-card-content>
      <!-- Format Tabs -->
      <mat-tab-group class="format-tabs">
        <!-- Format 1: Single Language (Legacy) -->
        <mat-tab label="üìã Single Language Format">
          <div class="tab-content">
            <h3>Legacy Format (Auto-converts to selected languages)</h3>
            <p>Use this format for single-language bulk import. Each question will be added in the currently selected languages.</p>
            <pre class="format-example">Question title here?
A) First option
B) Second option
C) Third option
D) Fourth option
Answer: B

Next question?
A) Option 1
B) Option 2
C) Option 3
D) Option 4
Answer: A</pre>
          </div>
        </mat-tab>

        <!-- Format 2: Multi-Language -->
        <mat-tab label="üåê Multi-Language Format">
          <div class="tab-content">
            <h3>Advanced Format (Each question in multiple languages)</h3>
            <p>Use language tags [LANG:xx] to define different versions of the same question. Separate questions with a blank line.</p>
            <pre class="format-example">[LANG:en]
What is the capital of India?
A) New Delhi
B) Mumbai
C) Kolkata
D) Bangalore
Answer: A
[LANG:hi]
‡§≠‡§æ‡§∞‡§§ ‡§ï‡•Ä ‡§∞‡§æ‡§ú‡§ß‡§æ‡§®‡•Ä ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?
A) ‡§®‡§à ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä
B) ‡§Æ‡•Å‡§Ç‡§¨‡§à
C) ‡§ï‡•ã‡§≤‡§ï‡§æ‡§§‡§æ
D) ‡§¨‡•á‡§Ç‡§ó‡§≤‡•Å‡§∞‡•Å
Answer: A

[LANG:en]
What is 2+2?
A) 3
B) 4
C) 5
D) 6
Answer: B
[LANG:hi]
2+2 ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?
A) 3
B) 4
C) 5
D) 6
Answer: B</pre>
            <p style="color: #666; font-size: 12px; margin-top: 12px;">
              <strong>Supported language codes:</strong> en, hi, es, fr, de, zh, ar, pt
            </p>
          </div>
        </mat-tab>
      </mat-tab-group>

      <form [formGroup]="bulkForm" (ngSubmit)="saveBulkQuestions()" class="form-section">
        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Paste Questions (Single or Multi-Language)</mat-label>
            <textarea 
              matInput 
              formControlName="bulkText" 
              rows="14" 
              placeholder="Paste multiple questions in single-language or multi-language format (see tabs above)..."></textarea>
            <mat-hint>
              ‚Ä¢ Single-language: Separate questions with blank line
              ‚Ä¢ Multi-language: Use [LANG:code] tags, separate questions with blank line
              ‚Ä¢ Auto-detects format based on [LANG:] tags
            </mat-hint>
          </mat-form-field>
        </div>

        <div class="action-buttons">
          <button mat-raised-button color="primary" type="submit" class="create-btn">
            <span>‚¨Ü Import Questions</span>
          </button>
          <span class="import-info" *ngIf="selectedLanguages.length > 1">
            üìç {{ selectedLanguages.length }} languages selected (single-language format will use them)
          </span>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

</div>
